<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>OTTN181V1</title>

<style>

/* GIỮ NGUYÊN MÀU */
:root {
    --primary: #0056b3;
    --light-blue: #ebf4ff;
    --border-color: #d1e3f8;
    --white: #ffffff;
    --gold: #f1c40f;
    --silver: #bdc3c7;
    --bronze: #cd7f32;
}

body{
    margin:0;
    font-family:'Segoe UI',Tahoma,sans-serif;
    background:#f8fbff;
}

.main-wrapper{
    width:380px;
    margin:20px auto;
}

/* KHUNG CHUNG */
.frame{
    background:white;
    border:2px solid var(--border-color);
    border-radius:15px;
    padding:15px;
    margin-bottom:15px;
}

/* KHUNG TÊN */
.header-box{
    text-align:center;
}

.header-box h1{
    margin:0;
    color:var(--primary);
    font-size:20px;
}

.header-box p{
    margin:0;
    font-size:12px;
    color:#666;
}

/* KHUNG ĐIỀU KHIỂN */
.control-box{

}

.control-title{
    text-align:center;
    font-weight:bold;
    color:var(--primary);
    margin-bottom:10px;
}

.rect{
    border:1px solid var(--border-color);
    border-radius:10px;
    padding:8px;
    margin-bottom:8px;
}

.rect label{
    font-size:13px;
}

.rect input,
.rect textarea{
    width:100%;
    margin-top:5px;
    padding:5px;
    border-radius:6px;
    border:1px solid #ccc;
}

.rect textarea{
    height:70px;
    resize:none;
}

.btn{
    width:100%;
    padding:10px;
    background:var(--primary);
    color:white;
    border:none;
    border-radius:10px;
    font-weight:bold;
    cursor:pointer;
}

/* CHECKBOX GRID */
.check-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    font-size:13px;
}

/* BẢNG XẾP HẠNG GIỮ NGUYÊN */
.rank-item {
    display: flex;
    flex-direction: column;
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #eee;
    margin-bottom: 8px;
}

.rank-item.top-1 { border: 2px solid var(--gold); }
.rank-item.top-2 { border: 2px solid var(--silver); }
.rank-item.top-3 { border: 2px solid var(--bronze); }

/* LOADING */
.loading{
    display:none;
    position:fixed;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:rgba(0,0,0,0.2);
    justify-content:center;
    align-items:center;
}

.loading-box{
    background:white;
    padding:20px;
    border-radius:10px;
    width:200px;
    text-align:center;
}

.bar{
    height:8px;
    background:#eee;
    border-radius:10px;
    margin-top:10px;
}

.progress{
    height:100%;
    width:0%;
    background:var(--primary);
    border-radius:10px;
}

</style>
</head>
<body>

<div class="main-wrapper">

    <!-- KHUNG 1: TÊN -->
    <div class="frame header-box">

        <h1>HUY QUIZ MASTER</h1>
        <p>Tác giả: Gia Huy</p>

    </div>

    <!-- KHUNG 2: ĐIỀU KHIỂN -->
    <div class="frame control-box">

        <div class="control-title">
            BẢNG ĐIỀU KHIỂN
        </div>

        <div class="rect">
            <label>Tải file</label>
            <input type="file" id="fileInput">
        </div>

        <div class="rect">
            <label>Thời gian (phút)</label>
            <input type="number" id="time" value="15">
        </div>

        <div class="rect">
            <label>Số câu muốn làm</label>
            <input type="number" id="limit">
        </div>

        <div class="rect">
            <div class="check-grid">
                <label><input type="checkbox" id="shuffleQ"> Xáo câu</label>
                <label><input type="checkbox" id="shuffleA"> Xáo đáp án</label>
            </div>
        </div>

        <div class="rect">
            <label>Tạo đề từ nội dung</label>
            <textarea id="content"></textarea>
            <button class="btn" onclick="generateQuiz()">TẠO ĐỀ</button>
        </div>

        <button class="btn" onclick="startQuiz()">
            BẮT ĐẦU
        </button>

    </div>

    <!-- KHUNG 3: BẢNG XẾP HẠNG (GIỮ NGUYÊN) -->
    <div class="frame">

        <div style="text-align:center;font-weight:bold;color:var(--primary);margin-bottom:10px">
            BẢNG XẾP HẠNG
        </div>

        <div id="leaderboardList"></div>

    </div>

</div>


<!-- LOADING -->
<div class="loading" id="loading">

    <div class="loading-box">

        Đang tạo đề...

        <div class="bar">
            <div class="progress" id="progress"></div>
        </div>

    </div>

</div>


<script>

/* DATA */
let quizData=[];
let history=JSON.parse(localStorage.getItem("huy_quiz_history"))||[];


/* LOAD FILE */
fileInput.onchange=e=>{

    let reader=new FileReader();

    reader.onload=()=>{

        let lines=reader.result.split("\n");

        quizData=[];

        lines.forEach(line=>{

            if(line.includes("Câu hỏi:")){

                quizData.push({
                    q:line.replace("Câu hỏi:",""),
                    correct:"Đáp án đúng"
                });

            }

        });

        alert("Đã tải "+quizData.length+" câu");

    };

    reader.readAsText(e.target.files[0]);

};


/* TẠO ĐỀ */
function generateQuiz(){

    let text=content.value;

    if(!text)return;

    showLoading(()=>{

        let parts=text.split(".");

        quizData=parts.map(x=>({
            q:x,
            correct:"Đáp án đúng"
        }));

        alert("Đã tạo "+quizData.length+" câu");

    });

}


/* START */
function startQuiz(){

    if(quizData.length==0){
        alert("Chưa có dữ liệu");
        return;
    }

    let limit=parseInt(document.getElementById("limit").value);

    if(limit) quizData=quizData.slice(0,limit);

    showLoading(()=>{

        alert("Đề sẵn sàng");

    });

}


/* LOADING */
function showLoading(callback){

    loading.style.display="flex";

    let p=0;

    let interval=setInterval(()=>{

        p+=10;

        progress.style.width=p+"%";

        if(p>=100){

            clearInterval(interval);

            setTimeout(()=>{

                loading.style.display="none";
                callback();

            },500);

        }

    },200);

}


/* LEADERBOARD GIỮ NGUYÊN */
function renderLeaderboard(){

    let sorted=[...history].sort((a,b)=>b.score-a.score);

    leaderboardList.innerHTML=sorted.map((h,i)=>`

    <div class="rank-item top-${i+1}">
        Hạng ${i+1}<br>
        Điểm: ${h.score}<br>
        ${h.date}
    </div>

    `).join("");

}

renderLeaderboard();

</script>

</body>
</html>